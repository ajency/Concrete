{%- assign blog = blogs[section.settings.blog] -%}

{%- if blog.articles_count > 0 -%}
  <div class="latest-articles blog-listing">
    <div class="section-block section-block-article container mb-3">
      <h2 class="title">Popular topics</h2>
      <div class="blog-main-tags container tag-slider slider">        
         {%- for tag in blog.all_tags -%}
           <a href="{{ blog.url }}/tagged/{{ tag | handle }}">{{ tag | uniq  }}</a>{% unless forloop.last %} {% endunless %}
         {%- endfor -%}
      </div>
    </div>   
    
      <div class="latest-articles-cards  featured-latest-articles" data-section-id="{{ section.id }}" data-section-type="article">
        <div class="row container m-auto">
          {%- for article in blog.articles limit: 6 -%}
            <div class="article-card col-md-4 col-sm-12 grid__item">
            <a href="{{ article.url }}" class="article__link" title="{{ article.title | escape }}">
              {% if article.image %}
                {% capture img_id %}ArticleImage-{{ article.image.id }}{% endcapture %}
                {% capture img_wrapper_id %}ArticleImageWrapper-{{ article.image.id }}{% endcapture %}
                {%- assign img_url = article.image | img_url: '1x1' | replace: '_1x1.', '_{width}x.' -%}

                {% include 'image-style', image: article.image, height: 210, wrapper_id: img_wrapper_id, img_id: img_id %}
                <div id="{{ img_wrapper_id }}" class="article__grid-image-wrapper js">
                  <div class="article__grid-image-container" data-image-loading-animation>
                    <img id="{{ img_id }}"
                        class="article__grid-image lazyload"
                        data-src="{{ img_url }}"
                        data-widths="[180, 360, 540, 720, 900, 1080, 1296, 1512, 1728, 2048]"
                        data-aspectratio="{{ article.image.aspect_ratio }}"
                        data-sizes="auto"
                        alt="">
                  </div>
                </div>
                <noscript>
                  <div class="article__grid-image-wrapper">
                    {{ article | img_url: '345x345', scale: 2 | img_tag: article.title, 'article__grid-image' }}
                  </div>
                </noscript>
              {% else %}
              <img id="{{ img_id }}"
                   class="article-featured-img lazyload"
                   data-src="https://cdn.shopify.com/s/files/1/0534/4532/9074/files/placeholder.png?v=1616349433"
                   data-widths="[180, 360, 540, 720, 900, 1080, 1296, 1512, 1728, 2048]"
                   data-aspectratio="{{ article.image.aspect_ratio }}"
                   data-sizes="auto"
                   alt="">
              {% endif %}
               </a>
              <div class="article-body">
                <div class="article-body-header">
                  <h2 class="title article__title h3{% if article.image %} article__title--has-image{% endif %}">
                    <a href="{{ article.url }}" class="article__link" title="{{ article.title | escape }}">
                      {{ article.title | escape }}
                    </a>
                  </h2>
                  <div class="article__grid--meta {% if article.image %} article__grid-meta{% endif %}">
                    {% if section.settings.blog_show_author %}
                      <span class="article__author">{{ 'blogs.article.by_author' | t: author: article.author }}</span>
                    {% endif %}


                      <span class="article__date">
                        {{ article.published_at | time_tag: format: 'date' }}
                      </span>
            <span class="comment-count">
                          {{ 'comment.svg' | asset_url | img_tag: 'comment', 'comment-icon' }}
                          {{ article.comments_count }} {% if article.comments_count < 2 %} comment {% else %} comments{% endif %}</span>
                  </div>
                </div>
                <div class="rte article__grid-excerpt content">
                  {% if article.excerpt.size > 0 %}
                  {{ article.excerpt }}
                  {% else %}
                  {{ article.content | strip_html | truncate: 150 }}
                  {% endif %}
                </div>

                {% if article.tags.size > 0 %}
                <div class="article__tags rte">
                  <ul class="list--inline" aria-label="{{ 'blogs.article.tags' | t }}">
                    {% for tag in article.tags %}
                    <li class="blog-tags">
                      <a href="{{ blog.url }}/tagged/{{ tag | handle }}" class="article__grid-tag" title="{{tag}}">{{ tag }}</a>
                    </li>
                    {% endfor %}
                  </ul>
                </div>
                {% endif %}
              </div>  
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  {%- endif -%}
{% schema %}
  {
    "name": "Featured Blog",
    "settings": [
      {
        "type": "blog",
        "id": "blog",
        "label": "Blog"
      }
    ],
    "presets": [
      {
        "name": "Featured product",
        "category": "Product"
      }
    ]
  }
{% endschema %}
